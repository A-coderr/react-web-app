{"ast":null,"code":"\"use strict\";\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.schema = exports.SchemaWrapper = exports.Ajv = exports.DEFAULT_AJV = void 0;\nconst ajv_1 = __importDefault(require(\"ajv\"));\nexports.Ajv = ajv_1.default;\nconst errors_1 = require(\"@feathersjs/errors\");\nexports.DEFAULT_AJV = new ajv_1.default({\n  coerceTypes: true,\n  addUsedSchema: false\n});\nclass SchemaWrapper {\n  constructor(definition, ajv = exports.DEFAULT_AJV) {\n    this.definition = definition;\n    this.ajv = ajv;\n    this.validator = this.ajv.compile({\n      $async: true,\n      ...this.definition\n    });\n  }\n  get properties() {\n    return this.definition.properties;\n  }\n  get required() {\n    return this.definition.required;\n  }\n  async validate(...args) {\n    try {\n      const validated = await this.validator(...args);\n      return validated;\n    } catch (error) {\n      throw new errors_1.BadRequest(error.message, error.errors);\n    }\n  }\n  toJSON() {\n    return this.definition;\n  }\n}\nexports.SchemaWrapper = SchemaWrapper;\nfunction schema(definition, ajv = exports.DEFAULT_AJV) {\n  return new SchemaWrapper(definition, ajv);\n}\nexports.schema = schema;","map":{"version":3,"names":["ajv_1","__importDefault","require","exports","Ajv","default","errors_1","DEFAULT_AJV","coerceTypes","addUsedSchema","SchemaWrapper","constructor","definition","ajv","validator","compile","$async","properties","required","validate","args","validated","error","BadRequest","message","errors","toJSON","schema"],"sources":["C:\\Users\\VARLab ROG 1\\Documents\\workspace\\web\\react-frontend\\node_modules\\@feathersjs\\authentication\\node_modules\\@feathersjs\\schema\\src\\schema.ts"],"sourcesContent":["import Ajv, { AsyncValidateFunction, ValidateFunction } from 'ajv'\nimport { FromSchema, JSONSchema } from 'json-schema-to-ts'\nimport { BadRequest } from '@feathersjs/errors'\n\nexport const DEFAULT_AJV = new Ajv({\n  coerceTypes: true,\n  addUsedSchema: false\n})\n\nexport { Ajv }\n\n/**\n * A validation function that takes data and returns the (possibly coerced)\n * data or throws a validation error.\n */\nexport type Validator<T = any, R = T> = (data: T) => Promise<R>\n\nexport type JSONSchemaDefinition = JSONSchema & {\n  $id: string\n  $async?: true\n  properties?: { [key: string]: JSONSchema }\n  required?: readonly string[]\n}\n\nexport interface Schema<T> {\n  validate<X = T>(...args: Parameters<ValidateFunction<X>>): Promise<X>\n}\n\nexport class SchemaWrapper<S extends JSONSchemaDefinition> implements Schema<FromSchema<S>> {\n  ajv: Ajv\n  validator: AsyncValidateFunction\n  readonly _type!: FromSchema<S>\n\n  constructor(\n    public definition: S,\n    ajv: Ajv = DEFAULT_AJV\n  ) {\n    this.ajv = ajv\n    this.validator = this.ajv.compile({\n      $async: true,\n      ...(this.definition as any)\n    }) as AsyncValidateFunction\n  }\n\n  get properties() {\n    return this.definition.properties as S['properties']\n  }\n\n  get required() {\n    return this.definition.required as S['required']\n  }\n\n  async validate<T = FromSchema<S>>(...args: Parameters<ValidateFunction<T>>) {\n    try {\n      const validated = (await this.validator(...args)) as T\n\n      return validated\n    } catch (error: any) {\n      throw new BadRequest(error.message, error.errors)\n    }\n  }\n\n  toJSON() {\n    return this.definition\n  }\n}\n\nexport function schema<S extends JSONSchemaDefinition>(definition: S, ajv: Ajv = DEFAULT_AJV) {\n  return new SchemaWrapper(definition, ajv)\n}\n"],"mappings":";;;;;;;;;;;AAAA,MAAAA,KAAA,GAAAC,eAAA,CAAAC,OAAA;AASSC,OAAA,CAAAC,GAAA,GATFJ,KAAA,CAAAK,OAAG;AAEV,MAAAC,QAAA,GAAAJ,OAAA;AAEaC,OAAA,CAAAI,WAAW,GAAG,IAAIP,KAAA,CAAAK,OAAG,CAAC;EACjCG,WAAW,EAAE,IAAI;EACjBC,aAAa,EAAE;CAChB,CAAC;AAqBF,MAAaC,aAAa;EAKxBC,YACSC,UAAa,EACpBC,GAAA,GAAWV,OAAA,CAAAI,WAAW;IADf,KAAAK,UAAU,GAAVA,UAAU;IAGjB,IAAI,CAACC,GAAG,GAAGA,GAAG;IACd,IAAI,CAACC,SAAS,GAAG,IAAI,CAACD,GAAG,CAACE,OAAO,CAAC;MAChCC,MAAM,EAAE,IAAI;MACZ,GAAI,IAAI,CAACJ;KACV,CAA0B;EAC7B;EAEA,IAAIK,UAAUA,CAAA;IACZ,OAAO,IAAI,CAACL,UAAU,CAACK,UAA6B;EACtD;EAEA,IAAIC,QAAQA,CAAA;IACV,OAAO,IAAI,CAACN,UAAU,CAACM,QAAyB;EAClD;EAEA,MAAMC,QAAQA,CAAoB,GAAGC,IAAqC;IACxE,IAAI;MACF,MAAMC,SAAS,GAAI,MAAM,IAAI,CAACP,SAAS,CAAC,GAAGM,IAAI,CAAO;MAEtD,OAAOC,SAAS;IAClB,CAAC,CAAC,OAAOC,KAAU,EAAE;MACnB,MAAM,IAAIhB,QAAA,CAAAiB,UAAU,CAACD,KAAK,CAACE,OAAO,EAAEF,KAAK,CAACG,MAAM,CAAC;IACnD;EACF;EAEAC,MAAMA,CAAA;IACJ,OAAO,IAAI,CAACd,UAAU;EACxB;;AApCFT,OAAA,CAAAO,aAAA,GAAAA,aAAA;AAuCA,SAAgBiB,MAAMA,CAAiCf,UAAa,EAAEC,GAAA,GAAWV,OAAA,CAAAI,WAAW;EAC1F,OAAO,IAAIG,aAAa,CAACE,UAAU,EAAEC,GAAG,CAAC;AAC3C;AAFAV,OAAA,CAAAwB,MAAA,GAAAA,MAAA"},"metadata":{},"sourceType":"script","externalDependencies":[]}