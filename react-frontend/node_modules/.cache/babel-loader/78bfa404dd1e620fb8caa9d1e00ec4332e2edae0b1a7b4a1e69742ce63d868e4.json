{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.authentication = exports.params = exports.disconnect = void 0;\nconst commons_1 = require(\"@feathersjs/commons\");\nconst debug = (0, commons_1.createDebug)('@feathersjs/socketio/middleware');\nconst disconnect = (app, getParams, socketMap) => {\n  app.on('disconnect', connection => {\n    const socket = socketMap.get(connection);\n    if (socket && socket.connected) {\n      socket.disconnect();\n    }\n  });\n  return (socket, next) => {\n    socket.on('disconnect', () => app.emit('disconnect', getParams(socket)));\n    next();\n  };\n};\nexports.disconnect = disconnect;\nconst params = (_app, socketMap) => (socket, next) => {\n  socket.feathers = {\n    provider: 'socketio',\n    headers: socket.handshake.headers\n  };\n  socketMap.set(socket.feathers, socket);\n  next();\n};\nexports.params = params;\nconst authentication = (app, getParams, settings = {}) => (socket, next) => {\n  const service = app.defaultAuthentication ? app.defaultAuthentication(settings.service) : null;\n  if (service === null) {\n    return next();\n  }\n  const config = service.configuration;\n  const authStrategies = config.parseStrategies || config.authStrategies || [];\n  if (authStrategies.length === 0) {\n    return next();\n  }\n  service.parse(socket.handshake, null, ...authStrategies).then(async authentication => {\n    if (authentication) {\n      debug('Parsed authentication from HTTP header', authentication);\n      socket.feathers.authentication = authentication;\n      await service.create(authentication, {\n        provider: 'socketio',\n        connection: getParams(socket)\n      });\n    }\n    next();\n  }).catch(next);\n};\nexports.authentication = authentication;","map":{"version":3,"names":["commons_1","require","debug","createDebug","disconnect","app","getParams","socketMap","on","connection","socket","get","connected","next","emit","exports","params","_app","feathers","provider","headers","handshake","set","authentication","settings","service","defaultAuthentication","config","configuration","authStrategies","parseStrategies","length","parse","then","create","catch"],"sources":["C:\\Users\\VARLab ROG 1\\Documents\\workspace\\web\\react-frontend\\node_modules\\@feathersjs\\socketio\\src\\middleware.ts"],"sourcesContent":["import { Application, Params, RealTimeConnection } from '@feathersjs/feathers'\nimport { createDebug } from '@feathersjs/commons'\nimport { Socket } from 'socket.io'\n\nconst debug = createDebug('@feathersjs/socketio/middleware')\n\nexport type ParamsGetter = (socket: Socket) => any\nexport type NextFunction = (err?: any) => void\nexport interface FeathersSocket extends Socket {\n  feathers?: Params & { [key: string]: any }\n}\n\nexport const disconnect = (\n  app: Application,\n  getParams: ParamsGetter,\n  socketMap: WeakMap<RealTimeConnection, FeathersSocket>\n) => {\n  app.on('disconnect', (connection: RealTimeConnection) => {\n    const socket = socketMap.get(connection)\n    if (socket && socket.connected) {\n      socket.disconnect()\n    }\n  })\n\n  return (socket: FeathersSocket, next: NextFunction) => {\n    socket.on('disconnect', () => app.emit('disconnect', getParams(socket)))\n    next()\n  }\n}\n\nexport const params =\n  (_app: Application, socketMap: WeakMap<RealTimeConnection, FeathersSocket>) =>\n  (socket: FeathersSocket, next: NextFunction) => {\n    socket.feathers = {\n      provider: 'socketio',\n      headers: socket.handshake.headers\n    }\n\n    socketMap.set(socket.feathers, socket)\n\n    next()\n  }\n\nexport const authentication =\n  (app: Application, getParams: ParamsGetter, settings: any = {}) =>\n  (socket: FeathersSocket, next: NextFunction) => {\n    const service = (app as any).defaultAuthentication\n      ? (app as any).defaultAuthentication(settings.service)\n      : null\n\n    if (service === null) {\n      return next()\n    }\n\n    const config = service.configuration\n    const authStrategies = config.parseStrategies || config.authStrategies || []\n\n    if (authStrategies.length === 0) {\n      return next()\n    }\n\n    service\n      .parse(socket.handshake, null, ...authStrategies)\n      .then(async (authentication: any) => {\n        if (authentication) {\n          debug('Parsed authentication from HTTP header', authentication)\n          socket.feathers.authentication = authentication\n          await service.create(authentication, {\n            provider: 'socketio',\n            connection: getParams(socket)\n          })\n        }\n\n        next()\n      })\n      .catch(next)\n  }\n"],"mappings":";;;;;;AACA,MAAAA,SAAA,GAAAC,OAAA;AAGA,MAAMC,KAAK,GAAG,IAAAF,SAAA,CAAAG,WAAW,EAAC,iCAAiC,CAAC;AAQrD,MAAMC,UAAU,GAAGA,CACxBC,GAAgB,EAChBC,SAAuB,EACvBC,SAAsD,KACpD;EACFF,GAAG,CAACG,EAAE,CAAC,YAAY,EAAGC,UAA8B,IAAI;IACtD,MAAMC,MAAM,GAAGH,SAAS,CAACI,GAAG,CAACF,UAAU,CAAC;IACxC,IAAIC,MAAM,IAAIA,MAAM,CAACE,SAAS,EAAE;MAC9BF,MAAM,CAACN,UAAU,EAAE;IACrB;EACF,CAAC,CAAC;EAEF,OAAO,CAACM,MAAsB,EAAEG,IAAkB,KAAI;IACpDH,MAAM,CAACF,EAAE,CAAC,YAAY,EAAE,MAAMH,GAAG,CAACS,IAAI,CAAC,YAAY,EAAER,SAAS,CAACI,MAAM,CAAC,CAAC,CAAC;IACxEG,IAAI,EAAE;EACR,CAAC;AACH,CAAC;AAhBYE,OAAA,CAAAX,UAAU,GAAAA,UAAA;AAkBhB,MAAMY,MAAM,GACjBA,CAACC,IAAiB,EAAEV,SAAsD,KAC1E,CAACG,MAAsB,EAAEG,IAAkB,KAAI;EAC7CH,MAAM,CAACQ,QAAQ,GAAG;IAChBC,QAAQ,EAAE,UAAU;IACpBC,OAAO,EAAEV,MAAM,CAACW,SAAS,CAACD;GAC3B;EAEDb,SAAS,CAACe,GAAG,CAACZ,MAAM,CAACQ,QAAQ,EAAER,MAAM,CAAC;EAEtCG,IAAI,EAAE;AACR,CAAC;AAXUE,OAAA,CAAAC,MAAM,GAAAA,MAAA;AAaZ,MAAMO,cAAc,GACzBA,CAAClB,GAAgB,EAAEC,SAAuB,EAAEkB,QAAA,GAAgB,EAAE,KAC9D,CAACd,MAAsB,EAAEG,IAAkB,KAAI;EAC7C,MAAMY,OAAO,GAAIpB,GAAW,CAACqB,qBAAqB,GAC7CrB,GAAW,CAACqB,qBAAqB,CAACF,QAAQ,CAACC,OAAO,CAAC,GACpD,IAAI;EAER,IAAIA,OAAO,KAAK,IAAI,EAAE;IACpB,OAAOZ,IAAI,EAAE;EACf;EAEA,MAAMc,MAAM,GAAGF,OAAO,CAACG,aAAa;EACpC,MAAMC,cAAc,GAAGF,MAAM,CAACG,eAAe,IAAIH,MAAM,CAACE,cAAc,IAAI,EAAE;EAE5E,IAAIA,cAAc,CAACE,MAAM,KAAK,CAAC,EAAE;IAC/B,OAAOlB,IAAI,EAAE;EACf;EAEAY,OAAO,CACJO,KAAK,CAACtB,MAAM,CAACW,SAAS,EAAE,IAAI,EAAE,GAAGQ,cAAc,CAAC,CAChDI,IAAI,CAAC,MAAOV,cAAmB,IAAI;IAClC,IAAIA,cAAc,EAAE;MAClBrB,KAAK,CAAC,wCAAwC,EAAEqB,cAAc,CAAC;MAC/Db,MAAM,CAACQ,QAAQ,CAACK,cAAc,GAAGA,cAAc;MAC/C,MAAME,OAAO,CAACS,MAAM,CAACX,cAAc,EAAE;QACnCJ,QAAQ,EAAE,UAAU;QACpBV,UAAU,EAAEH,SAAS,CAACI,MAAM;OAC7B,CAAC;IACJ;IAEAG,IAAI,EAAE;EACR,CAAC,CAAC,CACDsB,KAAK,CAACtB,IAAI,CAAC;AAChB,CAAC;AAjCUE,OAAA,CAAAQ,cAAc,GAAAA,cAAA"},"metadata":{},"sourceType":"script","externalDependencies":[]}