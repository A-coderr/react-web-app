{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.validateData = exports.validateQuery = void 0;\nconst errors_1 = require(\"@feathersjs/errors\");\nconst adapter_commons_1 = require(\"@feathersjs/adapter-commons\");\nconst validateQuery = schema => {\n  const validator = typeof schema === 'function' ? schema : schema.validate.bind(schema);\n  return async (context, next) => {\n    var _a;\n    const data = ((_a = context === null || context === void 0 ? void 0 : context.params) === null || _a === void 0 ? void 0 : _a.query) || {};\n    try {\n      const query = await validator(data);\n      Object.defineProperty(query, adapter_commons_1.VALIDATED, {\n        value: true\n      });\n      context.params = {\n        ...context.params,\n        query\n      };\n    } catch (error) {\n      throw error.ajv ? new errors_1.BadRequest(error.message, error.errors) : error;\n    }\n    if (typeof next === 'function') {\n      return next();\n    }\n  };\n};\nexports.validateQuery = validateQuery;\nconst validateData = schema => {\n  return async (context, next) => {\n    const data = context.data;\n    const validator = typeof schema.validate === 'function' ? schema.validate.bind(schema) : typeof schema === 'function' ? schema : schema[context.method];\n    if (validator) {\n      try {\n        if (Array.isArray(data)) {\n          context.data = await Promise.all(data.map(current => validator(current)));\n        } else {\n          context.data = await validator(data);\n        }\n        Object.defineProperty(context.data, adapter_commons_1.VALIDATED, {\n          value: true\n        });\n      } catch (error) {\n        throw error.ajv ? new errors_1.BadRequest(error.message, error.errors) : error;\n      }\n    }\n    if (typeof next === 'function') {\n      return next();\n    }\n  };\n};\nexports.validateData = validateData;","map":{"version":3,"names":["errors_1","require","adapter_commons_1","validateQuery","schema","validator","validate","bind","context","next","data","_a","params","query","Object","defineProperty","VALIDATED","value","error","ajv","BadRequest","message","errors","exports","validateData","method","Array","isArray","Promise","all","map","current"],"sources":["C:\\Users\\VARLab ROG 1\\Documents\\workspace\\web\\react-frontend\\node_modules\\@feathersjs\\authentication\\node_modules\\@feathersjs\\schema\\src\\hooks\\validate.ts"],"sourcesContent":["import { HookContext, NextFunction } from '@feathersjs/feathers'\nimport { BadRequest } from '@feathersjs/errors'\nimport { VALIDATED } from '@feathersjs/adapter-commons'\nimport { Schema, Validator } from '../schema'\nimport { DataValidatorMap } from '../json-schema'\n\nexport const validateQuery = <H extends HookContext>(schema: Schema<any> | Validator) => {\n  const validator: Validator = typeof schema === 'function' ? schema : schema.validate.bind(schema)\n\n  return async (context: H, next?: NextFunction) => {\n    const data = context?.params?.query || {}\n\n    try {\n      const query = await validator(data)\n\n      Object.defineProperty(query, VALIDATED, { value: true })\n\n      context.params = {\n        ...context.params,\n        query\n      }\n    } catch (error: any) {\n      throw error.ajv ? new BadRequest(error.message, error.errors) : error\n    }\n\n    if (typeof next === 'function') {\n      return next()\n    }\n  }\n}\n\nexport const validateData = <H extends HookContext>(schema: Schema<any> | DataValidatorMap | Validator) => {\n  return async (context: H, next?: NextFunction) => {\n    const data = context.data\n    const validator =\n      typeof (schema as Schema<any>).validate === 'function'\n        ? (schema as Schema<any>).validate.bind(schema)\n        : typeof schema === 'function'\n          ? schema\n          : (schema as any)[context.method]\n\n    if (validator) {\n      try {\n        if (Array.isArray(data)) {\n          context.data = await Promise.all(data.map((current) => validator(current)))\n        } else {\n          context.data = await validator(data)\n        }\n\n        Object.defineProperty(context.data, VALIDATED, { value: true })\n      } catch (error: any) {\n        throw error.ajv ? new BadRequest(error.message, error.errors) : error\n      }\n    }\n\n    if (typeof next === 'function') {\n      return next()\n    }\n  }\n}\n"],"mappings":";;;;;;AACA,MAAAA,QAAA,GAAAC,OAAA;AACA,MAAAC,iBAAA,GAAAD,OAAA;AAIO,MAAME,aAAa,GAA2BC,MAA+B,IAAI;EACtF,MAAMC,SAAS,GAAc,OAAOD,MAAM,KAAK,UAAU,GAAGA,MAAM,GAAGA,MAAM,CAACE,QAAQ,CAACC,IAAI,CAACH,MAAM,CAAC;EAEjG,OAAO,OAAOI,OAAU,EAAEC,IAAmB,KAAI;;IAC/C,MAAMC,IAAI,GAAG,EAAAC,EAAA,GAAAH,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEI,MAAM,cAAAD,EAAA,uBAAAA,EAAA,CAAEE,KAAK,KAAI,EAAE;IAEzC,IAAI;MACF,MAAMA,KAAK,GAAG,MAAMR,SAAS,CAACK,IAAI,CAAC;MAEnCI,MAAM,CAACC,cAAc,CAACF,KAAK,EAAEX,iBAAA,CAAAc,SAAS,EAAE;QAAEC,KAAK,EAAE;MAAI,CAAE,CAAC;MAExDT,OAAO,CAACI,MAAM,GAAG;QACf,GAAGJ,OAAO,CAACI,MAAM;QACjBC;OACD;IACH,CAAC,CAAC,OAAOK,KAAU,EAAE;MACnB,MAAMA,KAAK,CAACC,GAAG,GAAG,IAAInB,QAAA,CAAAoB,UAAU,CAACF,KAAK,CAACG,OAAO,EAAEH,KAAK,CAACI,MAAM,CAAC,GAAGJ,KAAK;IACvE;IAEA,IAAI,OAAOT,IAAI,KAAK,UAAU,EAAE;MAC9B,OAAOA,IAAI,EAAE;IACf;EACF,CAAC;AACH,CAAC;AAvBYc,OAAA,CAAApB,aAAa,GAAAA,aAAA;AAyBnB,MAAMqB,YAAY,GAA2BpB,MAAkD,IAAI;EACxG,OAAO,OAAOI,OAAU,EAAEC,IAAmB,KAAI;IAC/C,MAAMC,IAAI,GAAGF,OAAO,CAACE,IAAI;IACzB,MAAML,SAAS,GACb,OAAQD,MAAsB,CAACE,QAAQ,KAAK,UAAU,GACjDF,MAAsB,CAACE,QAAQ,CAACC,IAAI,CAACH,MAAM,CAAC,GAC7C,OAAOA,MAAM,KAAK,UAAU,GAC1BA,MAAM,GACLA,MAAc,CAACI,OAAO,CAACiB,MAAM,CAAC;IAEvC,IAAIpB,SAAS,EAAE;MACb,IAAI;QACF,IAAIqB,KAAK,CAACC,OAAO,CAACjB,IAAI,CAAC,EAAE;UACvBF,OAAO,CAACE,IAAI,GAAG,MAAMkB,OAAO,CAACC,GAAG,CAACnB,IAAI,CAACoB,GAAG,CAAEC,OAAO,IAAK1B,SAAS,CAAC0B,OAAO,CAAC,CAAC,CAAC;QAC7E,CAAC,MAAM;UACLvB,OAAO,CAACE,IAAI,GAAG,MAAML,SAAS,CAACK,IAAI,CAAC;QACtC;QAEAI,MAAM,CAACC,cAAc,CAACP,OAAO,CAACE,IAAI,EAAER,iBAAA,CAAAc,SAAS,EAAE;UAAEC,KAAK,EAAE;QAAI,CAAE,CAAC;MACjE,CAAC,CAAC,OAAOC,KAAU,EAAE;QACnB,MAAMA,KAAK,CAACC,GAAG,GAAG,IAAInB,QAAA,CAAAoB,UAAU,CAACF,KAAK,CAACG,OAAO,EAAEH,KAAK,CAACI,MAAM,CAAC,GAAGJ,KAAK;MACvE;IACF;IAEA,IAAI,OAAOT,IAAI,KAAK,UAAU,EAAE;MAC9B,OAAOA,IAAI,EAAE;IACf;EACF,CAAC;AACH,CAAC;AA5BYc,OAAA,CAAAC,YAAY,GAAAA,YAAA"},"metadata":{},"sourceType":"script","externalDependencies":[]}