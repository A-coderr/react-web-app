{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.rest = exports.formatter = void 0;\nconst express_1 = require(\"express\");\nconst errors_1 = require(\"@feathersjs/errors\");\nconst commons_1 = require(\"@feathersjs/commons\");\nconst transport_commons_1 = require(\"@feathersjs/transport-commons\");\nconst feathers_1 = require(\"@feathersjs/feathers\");\nconst authentication_1 = require(\"./authentication\");\nconst debug = (0, commons_1.createDebug)('@feathersjs/express/rest');\nconst toHandler = func => {\n  return (req, res, next) => func(req, res, next).catch(error => next(error));\n};\nconst serviceMiddleware = () => {\n  return toHandler(async (req, res, next) => {\n    const {\n      query,\n      headers,\n      path,\n      body: data,\n      method: httpMethod\n    } = req;\n    const methodOverride = req.headers[transport_commons_1.http.METHOD_HEADER];\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    const {\n      service,\n      params: {\n        __id: id = null,\n        ...route\n      } = {}\n    } = req.lookup;\n    const method = transport_commons_1.http.getServiceMethod(httpMethod, id, methodOverride);\n    const {\n      methods\n    } = (0, feathers_1.getServiceOptions)(service);\n    debug(`Found service for path ${path}, attempting to run '${method}' service method`);\n    if (!methods.includes(method) || feathers_1.defaultServiceMethods.includes(methodOverride)) {\n      const error = new errors_1.MethodNotAllowed(`Method \\`${method}\\` is not supported by this endpoint.`);\n      res.statusCode = error.code;\n      throw error;\n    }\n    const createArguments = transport_commons_1.http.argumentsFor[method] || transport_commons_1.http.argumentsFor.default;\n    const params = {\n      query,\n      headers,\n      route,\n      ...req.feathers\n    };\n    const args = createArguments({\n      id,\n      data,\n      params\n    });\n    const contextBase = (0, feathers_1.createContext)(service, method, {\n      http: {}\n    });\n    res.hook = contextBase;\n    const context = await service[method](...args, contextBase);\n    res.hook = context;\n    const response = transport_commons_1.http.getResponse(context);\n    res.statusCode = response.status;\n    res.set(response.headers);\n    res.data = response.body;\n    return next();\n  });\n};\nconst servicesMiddleware = () => {\n  return toHandler(async (req, res, next) => {\n    const app = req.app;\n    const lookup = app.lookup(req.path);\n    if (!lookup) {\n      return next();\n    }\n    req.lookup = lookup;\n    const options = (0, feathers_1.getServiceOptions)(lookup.service);\n    const middleware = options.express.composed;\n    return middleware(req, res, next);\n  });\n};\nconst formatter = (_req, res, next) => {\n  if (res.data === undefined) {\n    return next();\n  }\n  res.format({\n    'application/json'() {\n      res.json(res.data);\n    }\n  });\n};\nexports.formatter = formatter;\nconst rest = options => {\n  options = typeof options === 'function' ? {\n    formatter: options\n  } : options || {};\n  const formatterMiddleware = options.formatter || exports.formatter;\n  const authenticationOptions = options.authentication;\n  return app => {\n    if (typeof app.route !== 'function') {\n      throw new Error('@feathersjs/express/rest needs an Express compatible app.');\n    }\n    app.use((0, authentication_1.parseAuthentication)(authenticationOptions));\n    app.use(servicesMiddleware());\n    app.mixins.push((_service, _path, options) => {\n      const {\n        express: {\n          before = [],\n          after = []\n        } = {}\n      } = options;\n      const middlewares = [].concat(before, serviceMiddleware(), after, formatterMiddleware);\n      const middleware = (0, express_1.Router)().use(middlewares);\n      options.express || (options.express = {});\n      options.express.composed = middleware;\n    });\n  };\n};\nexports.rest = rest;","map":{"version":3,"names":["express_1","require","errors_1","commons_1","transport_commons_1","feathers_1","authentication_1","debug","createDebug","toHandler","func","req","res","next","catch","error","serviceMiddleware","query","headers","path","body","data","method","httpMethod","methodOverride","http","METHOD_HEADER","service","params","__id","id","route","lookup","getServiceMethod","methods","getServiceOptions","includes","defaultServiceMethods","MethodNotAllowed","statusCode","code","createArguments","argumentsFor","default","feathers","args","contextBase","createContext","hook","context","response","getResponse","status","set","servicesMiddleware","app","options","middleware","express","composed","formatter","_req","undefined","format","application/json","json","exports","rest","formatterMiddleware","authenticationOptions","authentication","Error","use","parseAuthentication","mixins","push","_service","_path","before","after","middlewares","concat","Router"],"sources":["C:\\Users\\VARLab ROG 1\\Documents\\workspace\\web\\react-frontend\\node_modules\\@feathersjs\\express\\src\\rest.ts"],"sourcesContent":["import { Request, Response, RequestHandler, Router } from 'express'\nimport { MethodNotAllowed } from '@feathersjs/errors'\nimport { createDebug } from '@feathersjs/commons'\nimport { http } from '@feathersjs/transport-commons'\nimport { createContext, defaultServiceMethods, getServiceOptions } from '@feathersjs/feathers'\n\nimport { AuthenticationSettings, parseAuthentication } from './authentication'\nimport { Application } from './declarations'\n\nconst debug = createDebug('@feathersjs/express/rest')\n\nconst toHandler = (\n  func: (req: Request, res: Response, next: () => void) => Promise<void>\n): RequestHandler => {\n  return (req, res, next) => func(req, res, next).catch((error) => next(error))\n}\n\nconst serviceMiddleware = (): RequestHandler => {\n  return toHandler(async (req, res, next) => {\n    const { query, headers, path, body: data, method: httpMethod } = req\n    const methodOverride = req.headers[http.METHOD_HEADER] as string | undefined\n\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    const { service, params: { __id: id = null, ...route } = {} } = req.lookup!\n    const method = http.getServiceMethod(httpMethod, id, methodOverride)\n    const { methods } = getServiceOptions(service)\n\n    debug(`Found service for path ${path}, attempting to run '${method}' service method`)\n\n    if (!methods.includes(method) || defaultServiceMethods.includes(methodOverride)) {\n      const error = new MethodNotAllowed(`Method \\`${method}\\` is not supported by this endpoint.`)\n      res.statusCode = error.code\n      throw error\n    }\n\n    const createArguments = http.argumentsFor[method as 'get'] || http.argumentsFor.default\n    const params = { query, headers, route, ...req.feathers }\n    const args = createArguments({ id, data, params })\n    const contextBase = createContext(service, method, { http: {} })\n    res.hook = contextBase\n\n    const context = await (service as any)[method](...args, contextBase)\n    res.hook = context\n\n    const response = http.getResponse(context)\n    res.statusCode = response.status\n    res.set(response.headers)\n    res.data = response.body\n\n    return next()\n  })\n}\n\nconst servicesMiddleware = (): RequestHandler => {\n  return toHandler(async (req, res, next) => {\n    const app = req.app as any as Application\n    const lookup = app.lookup(req.path)\n\n    if (!lookup) {\n      return next()\n    }\n\n    req.lookup = lookup\n\n    const options = getServiceOptions(lookup.service)\n    const middleware = options.express.composed\n\n    return middleware(req, res, next)\n  })\n}\n\nexport const formatter: RequestHandler = (_req, res, next) => {\n  if (res.data === undefined) {\n    return next()\n  }\n\n  res.format({\n    'application/json'() {\n      res.json(res.data)\n    }\n  })\n}\n\nexport type RestOptions = {\n  formatter?: RequestHandler\n  authentication?: AuthenticationSettings\n}\n\nexport const rest = (options?: RestOptions | RequestHandler) => {\n  options = typeof options === 'function' ? { formatter: options } : options || {}\n\n  const formatterMiddleware = options.formatter || formatter\n  const authenticationOptions = options.authentication\n\n  return (app: Application) => {\n    if (typeof app.route !== 'function') {\n      throw new Error('@feathersjs/express/rest needs an Express compatible app.')\n    }\n\n    app.use(parseAuthentication(authenticationOptions))\n    app.use(servicesMiddleware())\n\n    app.mixins.push((_service, _path, options) => {\n      const { express: { before = [], after = [] } = {} } = options\n\n      const middlewares = [].concat(before, serviceMiddleware(), after, formatterMiddleware)\n      const middleware = Router().use(middlewares)\n\n      options.express ||= {}\n      options.express.composed = middleware\n    })\n  }\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}